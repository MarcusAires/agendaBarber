<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Painel Administrativo</title>
</head>
<body>

    <div class="data-container">
        <h2>Painel Barbeiro</h2>
        <label>Agenda do dia:</label>
        <input type="date" id="data">
    </div>

    <h3 id="contador"></h3>

    <div class="horarios-wrapper">
        <div id="lista"></div>
    </div>

    <script>
        const key = "123segredo";
        const lista = document.getElementById("lista");
        const contador = document.getElementById("contador");
        const input = document.getElementById("data");

        const horarios = [
            "08:00", "08:30", "09:00", "09:30", "10:00", "10:30",
            "11:00", "11:30", "13:00", "13:30", "14:00", "14:30",
            "15:00", "15:30", "16:00", "16:30", "17:00", "17:30", "18:00"
        ];

        // Data de hoje autom√°tica
        const hoje = new Date();
        const dataLocal = hoje.toISOString().split('T')[0];
        input.value = dataLocal;

        input.onchange = carregar;
        carregar();

        async function carregar() {
            const r = await fetch("/agenda/" + input.value, {
                headers: { Authorization: key }
            });
            const dados = await r.json();
            const ocupados = dados.length;
            const livres = horarios.length - ocupados;

            contador.innerText = `Clientes: ${ocupados} | Livres: ${livres}`;
            lista.innerHTML = "";

            horarios.forEach(h => {
                const ag = dados.find(a => a.hora === h);
                const div = document.createElement("div");
                div.className = "slot " + (ag ? "ocupado" : "livre");

                if (ag) {
                    div.innerHTML = `
                        <div style="font-size: 1.2rem; border-bottom: 1px solid #ef9a9a; margin-bottom: 5px;"><b>${h}</b></div>
                        <div style="text-decoration: none;">üë§ ${ag.nome}</div>
                        <div style="font-size: 0.9rem; text-decoration: none;">‚úÇÔ∏è ${ag.servico}</div>
                        <button onclick="del(${ag.id})" style="width: auto; padding: 5px 10px; font-size: 12px; background: #ba1a1a; margin-top: 10px;">Excluir</button>
                    `;
                    // Removemos o line-through do texto no slot ocupado do admin para facilitar a leitura
                    div.style.textDecoration = "none"; 
                } else {
                    div.innerHTML = `<b>${h}</b><br> <span style="font-weight: normal; opacity: 0.7;">Dispon√≠vel</span>`;
                }
                lista.appendChild(div);
            });
        }

        async function del(id) {
    // Se o confirm do navegador sumiu, voc√™ pode remover o 'if(confirm...)' 
    // apenas para testar se a exclus√£o volta a funcionar:
    
    try {
        const response = await fetch("/delete/" + id, {
            method: "DELETE",
            headers: { Authorization: key }
        });

        if (response.ok) {
            carregar(); 
        }
    } catch (erro) {
        console.error("Erro ao excluir:", erro);
    }
}
    </script>
</body>
</html>