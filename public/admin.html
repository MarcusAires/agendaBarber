<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Painel Administrativo</title>
</head>

<body>

    <div class="data-container">
        <h2>Painel Barbeiro</h2>
        <label>Agenda do dia:</label>
        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%; gap: 10px;">
            <button type="button" class="btn-seta" onclick="alterarData(-1)">‚ùÆ</button>
            <div id="dataExibicao" class="data-display">...</div>
            <button type="button" class="btn-seta" onclick="alterarData(1)">‚ùØ</button>
        </div>
        <input type="hidden" id="data">
    </div>
    <div id="contador" style="margin-bottom: 15px; font-weight: bold; color: #666; text-align: center;"></div>

    <h3 id="contador"></h3>

    <div class="horarios-wrapper">
        <div id="lista"></div>
    </div>

    <script>
        const key = "123segredo";
        const lista = document.getElementById("lista");
        const contador = document.getElementById("contador");
        const input = document.getElementById("data"); // Agora √© o hidden
        const display = document.getElementById("dataExibicao");

        const horarios = [
            "08:00", "08:30", "09:00", "09:30", "10:00", "10:30",
            "11:00", "11:30", "13:00", "13:30", "14:00", "14:30",
            "15:00", "15:30", "16:00", "16:30", "17:00", "17:30", "18:00"
        ];

        let dataAtual = new Date();

        // Fun√ß√µes de Formata√ß√£o
        function formatarParaISO(date) {
            const z = n => String(n).padStart(2, '0');
            return `${date.getFullYear()}-${z(date.getMonth() + 1)}-${z(date.getDate())}`;
        }

        function formatarParaExibicao(date) {
            return date.toLocaleDateString('pt-BR', {
                weekday: 'short', day: '2-digit', month: 'short'
            }).replace('.', '');
        }

        // Fun√ß√£o que une a navega√ß√£o com a sua busca original
        function atualizarInterfaceData() {
            input.value = formatarParaISO(dataAtual);
            display.innerText = formatarParaExibicao(dataAtual);
            carregar(); // Chama sua fun√ß√£o original de busca
        }

        function alterarData(dias) {
            dataAtual.setDate(dataAtual.getDate() + dias);
            atualizarInterfaceData();
        }

        // Sua fun√ß√£o original de carregar (mantive id√™ntica, s√≥ usa o novo input.value)
        async function carregar() {
            try {
                const r = await fetch("/agenda/" + input.value, {
                    headers: { Authorization: key }
                });
                const dados = await r.json();
                const ocupados = dados.length;
                const livres = horarios.length - ocupados;

                contador.innerText = `Clientes: ${ocupados} | Livres: ${livres}`;
                lista.innerHTML = "";

                horarios.forEach(h => {
                    const ag = dados.find(a => a.hora === h);
                    const div = document.createElement("div");
                    div.className = "slot " + (ag ? "ocupado" : "livre");

                    if (ag) {
                        div.innerHTML = `
                        <div style="font-size: 1.2rem; border-bottom: 1px solid #ef9a9a; margin-bottom: 5px;"><b>${h}</b></div>
                        <div style="text-decoration: none;">üë§ ${ag.nome}</div>
                        <div style="font-size: 0.9rem; text-decoration: none;">‚úÇÔ∏è ${ag.servico}</div>
                        <button onclick="del(${ag.id})" style="width: auto; padding: 5px 10px; font-size: 12px; background: #ba1a1a; margin-top: 10px;">Excluir</button>
                    `;
                        div.style.textDecoration = "none";
                    } else {
                        div.innerHTML = `<b>${h}</b><br> <span style="font-weight: normal; opacity: 0.7;">Dispon√≠vel</span>`;
                    }
                    lista.appendChild(div);
                });
            } catch (erro) {
                console.error("Erro ao carregar agenda:", erro);
            }
        }

        // Sua fun√ß√£o original de deletar
        async function del(id) {
            try {
                const response = await fetch("/delete/" + id, {
                    method: "DELETE",
                    headers: { Authorization: key }
                });

                if (response.ok) {
                    carregar();
                }
            } catch (erro) {
                console.error("Erro ao excluir:", erro);
            }
        }

        // Inicia o Admin no dia de hoje
        atualizarInterfaceData();
    </script>
</body>

</html>